/*
 * VRM API
 *
 * ## Introduction This document provides a brief overview of some of the available endpoints and their parameters. The API is a REST API, accepting JSON as request body. You can use the try-it tool to play around with it, or use software like Postman.  ## Authentication Most endpoints require authentication, using a JWT token. This token should be placed in the `x-authorization` field in the HTTP header. There are two types of tokens. - Bearer token. Uses the `Bearer <token_value>` format. This is used when logging in to VRM, for example. Can be retrieved from [/auth/login](/operations/auth/login) or [/auth/loginAsDemo](/operations/auth/loginAsDemo). - Access token. Uses the `Token <token_value>` format. This is commonly used for third party applications using the VRM API. Can be created using [/users/{idUser}/accesstokens/create](/operations/users/idUser/accesstokens/create).  ## Rate limiting Most endpoints are by default rate limited with a rolling window of max 200 requests, where every 0.33 seconds a request gets removed from the rolling window. (so on average maximum of 3 requests per second won't get rate limited). There are different types of ratelimiting in VRM. If you receive a 429 with a JSON response, you can check the Retry-After response header to check the amount of seconds you have to wait until retrying.  ## WARNING & DISCLAIMER Whilst publicly available, Victron Energy does not offer support to professional customers or end-users that implement features using the here documented functionality, except in really specific situations (i.e such as a special arrangement with a large OEM customer).  The recommended method for support on the VRM API is to use the Modifications section on Victron Community. This space is frequently visited by many people using the API, and other methods of integrating with Victron products. Direct company support is only offered on a limited basis via your Victron representative.
 *
 * The version of the OpenAPI document: 2
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

#nullable enable

using System;
using System.Collections.Generic;
using System.Net.Http;
using System.Text.Json;
using System.Text.Json.Serialization;
using Microsoft.Extensions.DependencyInjection;
using Org.OpenAPITools.Api;
using Org.OpenAPITools.Model;

namespace Org.OpenAPITools.Client
{
    /// <summary>
    /// Provides hosting configuration for Org.OpenAPITools
    /// </summary>
    public class HostConfiguration
    {
        private readonly IServiceCollection _services;
        private readonly JsonSerializerOptions _jsonOptions = new JsonSerializerOptions();

        internal bool HttpClientsAdded { get; private set; }

        /// <summary>
        /// Instantiates the class 
        /// </summary>
        /// <param name="services"></param>
        public HostConfiguration(IServiceCollection services)
        {
            _services = services;
            _jsonOptions.Converters.Add(new JsonStringEnumConverter());
            _jsonOptions.Converters.Add(new DateTimeJsonConverter());
            _jsonOptions.Converters.Add(new DateTimeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyNullableJsonConverter());
            _jsonOptions.Converters.Add(new AuthLogin200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new AuthLogin401ResponseJsonConverter());
            _jsonOptions.Converters.Add(new AuthLogin401ResponseErrorsJsonConverter());
            _jsonOptions.Converters.Add(new AuthLoginAsDemo200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new AuthLoginRequestJsonConverter());
            _jsonOptions.Converters.Add(new AuthLogout200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new DataAttributesGet200ResponseValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationOverviewDownload200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationOverviewDownload200ResponseDataValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationOverviewDownloadRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationOverviewDownloadRequestColumnsValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsDelete200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsDeleteRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsGet200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsGet200ResponseAlarmsInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsGet200ResponseAttributesInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsGet200ResponseDevicesInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsGet200ResponseUsersInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsPost200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsPost200ResponseDataJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsPut200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsPut200ResponseDataJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteAlarmsPutRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteClearAlarm200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteClearAlarmRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteCustomWidgetDeleteRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteCustomWidgetGet200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteCustomWidgetPatchRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteCustomWidgetPost200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteCustomWidgetPostRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDataDownload200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDiagnostics200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDiagnostics200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDiagnostics200ResponseRecordsDataAttributeEnumValuesInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDiagnostics200ResponseRecordsRawValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDynamicEssSettingsGet200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDynamicEssSettingsGet200ResponseDataJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDynamicEssSettingsGet200ResponseDataBuyPriceScheduleInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDynamicEssSettingsGet200ResponseDataBuyPriceScheduleInnerScheduleInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDynamicEssSettingsGet403ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDynamicEssSettingsGet404ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteDynamicEssSettingsPostRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteInvitePost200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteInvitePost200ResponseDataJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteInvitePostRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteOverallstats200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteOverallstats200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteOverallstats200ResponseRecordsYearJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteResetForecastsGet200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteResetForecastsPost200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteResetForecastsPost400ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteResetForecastsPostRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSettings200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSettings200ResponseDataJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSettingsRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteStats200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteStats200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteStats200ResponseRecordsOneOfValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteStats200ResponseRecordsOneOfValue1JsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteStats200ResponseTotalsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteStats200ResponseTotalsOneOfValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteStats200ResponseTotalsOneOfValue1JsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerInputTypeJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerLastConnectionJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerLastPowerUpOrRestartJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerLoggingIntervalJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerPLJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerProductIdJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerRemoteSupportPortJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerSettingsInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerSettingsInnerEnumDataInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerSettingsInnerValuesValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerVidJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerVidDevicesPerPhaseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsDevicesInnerVmcJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsUnconfiguredDevicesJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteSystemOverview200ResponseRecordsUnconfiguredDevicesOneOfInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteTagsDelete200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteTagsGet200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteTagsPut200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteTagsPutRequestJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsBatterySummary200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsBatterySummary200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsBatterySummary200ResponseRecordsDataJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsBatterySummary200ResponseRecordsDataValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsBatterySummary200ResponseRecordsDataValueDataAttributeEnumValuesInnerJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGPS200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGPS200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGPS200ResponseRecordsDataJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGPS200ResponseRecordsDataAttributesJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGPS200ResponseRecordsDataAttributesSecondsAgoJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGPS200ResponseRecordsDataAttributesValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGPS200ResponseRecordsMetaValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGeneratorState200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGeneratorState200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGeneratorState200ResponseRecordsBucketsValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGeneratorState200ResponseRecordsDataValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGraph200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGraph200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsGraph200ResponseRecordsMetaValueJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsHoursOfAc200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallationsIdSiteWidgetsHoursOfAc200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAccesstokensCreate200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAccesstokensCreateRequestJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAccesstokensList200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAccesstokensList200ResponseTokensInnerJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAccesstokensRevoke200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAccesstokensRevoke200ResponseDataJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAddsite200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAddsite200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserAddsiteRequestJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserGetSiteId200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserGetSiteId200ResponseRecordsJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerExtendedInnerJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerExtendedInnerAnyOfJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerExtendedInnerAnyOf1JsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerExtendedInnerAnyOf1DataAttributesInnerJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerExtendedInnerAnyOfDataAttributeEnumValuesInnerJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerImagesInnerJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerTagsInnerJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations200ResponseRecordsInnerViewPermissionsJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserInstallations403ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserSearch200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserSearch200ResponseResultsJsonConverter());
            _jsonOptions.Converters.Add(new UsersIdUserSearch400ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersMe200ResponseJsonConverter());
            _jsonOptions.Converters.Add(new UsersMe200ResponseUserJsonConverter());
            JsonSerializerOptionsProvider jsonSerializerOptionsProvider = new(_jsonOptions);
            _services.AddSingleton(jsonSerializerOptionsProvider);
            _services.AddSingleton<IApiFactory, ApiFactory>();
            _services.AddSingleton<DefaultApiEvents>();
            _services.AddTransient<IDefaultApi, DefaultApi>();
            _services.AddSingleton<GeneralWidgetsApiEvents>();
            _services.AddTransient<IGeneralWidgetsApi, GeneralWidgetsApi>();
            _services.AddSingleton<InstallationsApiEvents>();
            _services.AddTransient<IInstallationsApi, InstallationsApi>();
            _services.AddSingleton<StateWidgetsApiEvents>();
            _services.AddTransient<IStateWidgetsApi, StateWidgetsApi>();
            _services.AddSingleton<SummaryWidgetsApiEvents>();
            _services.AddTransient<ISummaryWidgetsApi, SummaryWidgetsApi>();
            _services.AddSingleton<UsersApiEvents>();
            _services.AddTransient<IUsersApi, UsersApi>();
        }

        /// <summary>
        /// Configures the HttpClients.
        /// </summary>
        /// <param name="client"></param>
        /// <param name="builder"></param>
        /// <returns></returns>
        public HostConfiguration AddApiHttpClients
        (
            Action<HttpClient>? client = null, Action<IHttpClientBuilder>? builder = null)
        {
            if (client == null)
                client = c => c.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS);

            List<IHttpClientBuilder> builders = new List<IHttpClientBuilder>();

            builders.Add(_services.AddHttpClient<IDefaultApi, DefaultApi>(client));
            builders.Add(_services.AddHttpClient<IGeneralWidgetsApi, GeneralWidgetsApi>(client));
            builders.Add(_services.AddHttpClient<IInstallationsApi, InstallationsApi>(client));
            builders.Add(_services.AddHttpClient<IStateWidgetsApi, StateWidgetsApi>(client));
            builders.Add(_services.AddHttpClient<ISummaryWidgetsApi, SummaryWidgetsApi>(client));
            builders.Add(_services.AddHttpClient<IUsersApi, UsersApi>(client));

            if (builder != null)
                foreach (IHttpClientBuilder instance in builders)
                    builder(instance);

            HttpClientsAdded = true;

            return this;
        }

        /// <summary>
        /// Configures the JsonSerializerSettings
        /// </summary>
        /// <param name="options"></param>
        /// <returns></returns>
        public HostConfiguration ConfigureJsonOptions(Action<JsonSerializerOptions> options)
        {
            options(_jsonOptions);

            return this;
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="token"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(TTokenBase token) where TTokenBase : TokenBase
        {
            return AddTokens(new TTokenBase[] { token });
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="tokens"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(IEnumerable<TTokenBase> tokens) where TTokenBase : TokenBase
        {
            TokenContainer<TTokenBase> container = new TokenContainer<TTokenBase>(tokens);
            _services.AddSingleton(services => container);

            return this;
        }

        /// <summary>
        /// Adds a token provider to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenProvider"></typeparam>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <returns></returns>
        public HostConfiguration UseProvider<TTokenProvider, TTokenBase>()
            where TTokenProvider : TokenProvider<TTokenBase>
            where TTokenBase : TokenBase
        {
            _services.AddSingleton<TTokenProvider>();
            _services.AddSingleton<TokenProvider<TTokenBase>>(services => services.GetRequiredService<TTokenProvider>());

            return this;
        }
    }
}
